@using ToDoList.Domain.Core.Enums
@model List<ToDoList.Domain.Core.Dtos.ToDoItemDto>
@{
    Layout = "_Layout";
    ViewData["Title"] = "لیست کارها";
}

<style>
    .task-item {
        display: flex;
        align-items: stretch; 
        justify-content: space-between;
        border: 1px solid #fcb6b6;
        border-radius: 12px;
        background-color: #fff;
        margin-bottom: 15px;
        padding: 0; 
        overflow: hidden;
        transition: box-shadow 0.3s ease;
    }

        .task-item:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

    .task-status-bar {
        width: 8px;
        height: auto;
        min-height: 100%; 

        margin-right: 12px; 
        flex-shrink: 0;
        order: -1; 
    }

   
    .status-done .task-status-bar {
        background-color: #4CAF50; 
    }
    .status-inprogress .task-status-bar {
        background-color: #2196F3; 
    }
    .status-overdue .task-status-bar {
        background-color: #E53935; 
    }

   
    .task-content {
        flex: 1; 
        padding: 12px 10px 12px 0; 
        line-height: 1.6;
    }

        .task-content strong {
            font-size: 1.1rem;
            color: #444;
        }

        .task-content small {
            color: #777;
        }

    .task-actions {
        display: flex;
        flex-direction: row;
        align-items: center; 
        gap: 10px;
        padding: 0 15px;
        flex-shrink: 0; 
    }

    .task-btn {
        padding: 6px 8px; 
        width: auto;
        min-width: 60px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: background-color 0.3s ease;
        color: #fff;
    }

        .task-btn.edit {
            background-color: #ffd6d6;
            color: #444; 
        }

            .task-btn.edit:hover {
                background-color: #fda4a4;
            }

        .task-btn.delete {
            background-color: #e74c3c;
        }

            .task-btn.delete:hover {
                background-color: #c0392b;
            }
</style>

<div class="form-card">
    <div class="form-title">فهرست کارها</div>

    <a asp-action="Create">
        <button>➕ افزودن کار جدید</button>
    </a>

    <hr />

    @if (Model.Count == 0)
    {
        <p>هیچ کاری ثبت نشده است.</p>
    }
    else
    {
        @foreach (var item in Model)
        {
            string statusClass;

            if (item.Status == ToDoStatus.Done)
            {
                statusClass = "status-done"; 
            }
            else if (item.DueDate.HasValue && item.DueDate.Value < DateTime.Now)
            {
                statusClass = "status-overdue"; 
            }
            else
            {
                statusClass = "status-inprogress"; 
            }
            
            // 2. ساختار HTML اصلاح شده:
            <div class="task-item @statusClass">
                <div class="task-status-bar"></div> <div class="task-content">
                    <strong>@item.Title</strong><br />
                    <small>@item.CategoryName | تاریخ: @(item.DueDate?.ToString("yyyy/MM/dd"))</small><br />
                    <p>@item.Description</p>
                </div>

                <div class="task-actions">
                    <a asp-action="Edit" asp-route-id="@item.Id">
                        <button class="task-btn edit">✏️ ویرایش</button>
                    </a>
                    <a asp-action="Delete" asp-route-id="@item.Id">
                        <button class="task-btn delete">🗑 حذف</button>
                    </a>
                </div>
            </div>
        }
    }
</div>